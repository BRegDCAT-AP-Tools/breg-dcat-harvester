version: "3.7"
services:
  redis:
    image: redis:5
    ports:
      - "6379"
  virtuoso:
    image: tenforce/virtuoso:virtuoso7.2.5
    environment:
      DBA_PASSWORD: dba
      SPARQL_UPDATE: "true"
      DEFAULT_GRAPH: http://www.example.com/my-graph
    ports:
      - "8890"
      - "1111"
  api:
    build: .
    image: breg-harvester
    ports:
      - "9090:80"
    depends_on:
      - redis
      - virtuoso
    environment:
      HARVESTER_SOURCES: ${HARVESTER_SOURCES}
      HARVESTER_VALIDATOR_DISABLED: 1
  worker:
    image: breg-harvester
    depends_on:
      - redis
      - virtuoso
    command:
      [
        "/usr/local/bin/rq",
        "worker",
        "--with-scheduler",
        "--url",
        "redis://redis",
      ]
